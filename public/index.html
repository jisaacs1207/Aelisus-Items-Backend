<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parsed Data</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <h1>Parsed Data</h1>
    <div>
        <input type="text" id="searchInput" onkeyup="searchData()" placeholder="Search by third column...">
        <select id="categorySelect" onchange="filterData()">
            <option value="armor">Armor</option>
            <option value="weapons">Weapons</option>
            <option value="consumables">Consumables</option>
        </select>
        <select id="raritySelect" onchange="filterData()">
            <option value="All">All</option>
            <option value="Common">Common</option>
            <option value="Rare">Rare</option>
            <option value="Unique">Unique</option>
        </select>
        <!-- New dropdown for filtering by Area -->
        <select id="areaSelect" onchange="filterData()">
            <option value="All">All</option>
        </select>
    </div>
    <br>
    <table id="dataTable">
        <tbody>
            <!-- Data rows will be dynamically added here -->
        </tbody>
    </table>

    <script>
        fetch('/parsedData')
            .then(response => response.json())
            .then(parsedData => {
                let currentData = parsedData;

                function filterData() {
                    const category = document.getElementById('categorySelect').value;
                    const rarity = document.getElementById('raritySelect').value;
                    const area = document.getElementById('areaSelect').value;

                    currentData = parsedData[category].filter(item => {
                        const matchRarity = rarity === 'All' || item['U/R/C'] === rarity.charAt(0);
                        const matchArea = area === 'All' || item['area'].toLowerCase() === area.toLowerCase();

                        return matchRarity && matchArea;
                    });

                    const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
                    if (searchInput !== '') {
                        const filteredData = currentData.filter(item => {
                            const columnValue = item['short'];
                            return columnValue && columnValue.toLowerCase().includes(searchInput);
                        });
                        renderTable(filteredData);
                    } else {
                        renderTable(currentData);
                    }
                }


                function renderTable(data) {
                    const tableBody = document.querySelector('#dataTable tbody');
                    tableBody.innerHTML = '';

                    data.forEach(item => {
                        const row = document.createElement('tr');

                        // Render the short column
                        const shortCell = document.createElement('td');
                        shortCell.textContent = item['short'];
                        row.appendChild(shortCell);

                        // Render the level column
                        const levelCell = document.createElement('td');
                        levelCell.textContent = item['level'];
                        row.appendChild(levelCell);

                        // Render the area column
                        const areaCell = document.createElement('td');
                        areaCell.textContent = item['area'];
                        row.appendChild(areaCell);

                        // Render the U/R/C column with corresponding meanings
                        const rarityCell = document.createElement('td');
                        rarityCell.textContent = getRarityMeaning(item['U/R/C']);
                        row.appendChild(rarityCell);

                        // Skip rendering the short, level, area, and U/R/C columns
                        const keys = Object.keys(item).filter(key => key !== 'short' && key !== 'level' && key !== 'area' && key !== 'U/R/C');
                        keys.forEach(key => {
                            const cell = document.createElement('td');
                            cell.textContent = item[key];
                            row.appendChild(cell);
                        });
                        tableBody.appendChild(row);
                    });
                }

                function searchData() {
                    const searchInput = document.getElementById('searchInput').value.toLowerCase();
                    const filteredData = currentData.filter(item => {
                        const columnValue = item['short'];
                        return columnValue && columnValue.toLowerCase().includes(searchInput);
                    });
                    renderTable(filteredData);
                }

                // Populate the Area dropdown with unique values
                const areaSelect = document.getElementById('areaSelect');
                const areas = new Set(parsedData.armor.map(item => item.area)); // Assuming armor has all possible areas
                areas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area.toLowerCase(); // Ensure lowercase
                    option.textContent = area;
                    areaSelect.appendChild(option);
                });

                // Helper function to get the meaning of U/R/C
                function getRarityMeaning(value) {
                    switch (value) {
                        case 'U':
                            return 'Unique';
                        case 'R':
                            return 'Rare';
                        case 'C':
                            return 'Common';
                        default:
                            return '';
                    }
                }

                filterData();

                window.filterData = filterData;
                window.searchData = searchData;
            })
            .catch(error => console.error('Error fetching parsed data:', error));
    </script>
</body>

</html>